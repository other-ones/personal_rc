INFO:albumentations.check_version:A new version of Albumentations is available: 1.4.15 (you have 1.4.11). Upgrade using: pip install --upgrade albumentations
WARNING:xformers:WARNING[XFORMERS]: xFormers can't load C++/CUDA extensions. xFormers was built for:
    PyTorch 2.1.1+cu121 with CUDA 1201 (you have 2.1.1+cu118)
    Python  3.9.18 (you have 3.9.19)
  Please reinstall xformers (see https://github.com/facebookresearch/xformers#installing-xformers)
  Memory-efficient attention, SwiGLU, sparse and more won't be available.
  Set XFORMERS_MORE_DETAILS=1 for more details
INFO:__main__:Distributed environment: NO
Num processes: 1
Process index: 0
Local process index: 0
Device: cuda

Mixed precision type: no

/home/twkim/anaconda3/envs/context/lib/python3.9/site-packages/huggingface_hub/file_download.py:1150: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
{'thresholding', 'timestep_spacing', 'sample_max_value', 'clip_sample_range', 'dynamic_thresholding_ratio', 'prediction_type', 'variance_type'} was not found in config. Values will be initialized to default values.
{'scaling_factor'} was not found in config. Values will be initialized to default values.
{'addition_embed_type_num_heads', 'upcast_attention', 'mid_block_type', 'num_attention_heads', 'time_embedding_act_fn', 'cross_attention_norm', 'encoder_hid_dim_type', 'timestep_post_act', 'addition_embed_type', 'conv_out_kernel', 'resnet_skip_time_act', 'transformer_layers_per_block', 'resnet_out_scale_factor', 'conv_in_kernel', 'addition_time_embed_dim', 'time_embedding_type', 'class_embed_type', 'dual_cross_attention', 'only_cross_attention', 'encoder_hid_dim', 'use_linear_projection', 'num_class_embeds', 'resnet_time_scale_shift', 'class_embeddings_concat', 'projection_class_embeddings_input_dim', 'time_cond_proj_dim', 'time_embedding_dim', 'mid_block_only_cross_attention'} was not found in config. Values will be initialized to default values.
INFO:__main__:***** Running training *****
INFO:__main__:  Num examples = 10000000
INFO:__main__:  Num Epochs = 1
INFO:__main__:  Instantaneous batch size per device = 2
INFO:__main__:  Total train batch size (w. parallel, distributed & accumulation) = 8
INFO:__main__:  Gradient Accumulation steps = 4
INFO:__main__:  Total optimization steps = 1000000
set seed 2940
32 norm_num_groups
320 block_out_channels[0]
32 norm_num_groups
[49409] mask_token_ids
seeded
captions_nonliving_relations	29376
captions_nonliving_styles	378
captions_nonliving_human_interactions	4176
captions_nonliving_backgrounds	552
captions_nonliving_creatives	117
seeded
captions_nonliving_relations	29376
captions_nonliving_styles	378
captions_nonliving_human_interactions	4176
captions_nonliving_backgrounds	552
captions_nonliving_creatives	117
position_ids defined_key-clsnet
final.weight defined_key-clsnet
final.bias defined_key-clsnet
position_embedding.weight defined_key-clsnet
multi_head_attention1.in_proj_weight defined_key-clsnet
multi_head_attention1.in_proj_bias defined_key-clsnet
multi_head_attention1.out_proj.weight defined_key-clsnet
multi_head_attention1.out_proj.bias defined_key-clsnet
feed_forward1.W_ff1.weight defined_key-clsnet
feed_forward1.W_ff1.bias defined_key-clsnet
feed_forward1.W_ff2.weight defined_key-clsnet
feed_forward1.W_ff2.bias defined_key-clsnet
layer_norm1.weight defined_key-clsnet
layer_norm1.bias defined_key-clsnet
multi_head_attention2.in_proj_weight defined_key-clsnet
multi_head_attention2.in_proj_bias defined_key-clsnet
multi_head_attention2.out_proj.weight defined_key-clsnet
multi_head_attention2.out_proj.bias defined_key-clsnet
layer_norm2.weight defined_key-clsnet
layer_norm2.bias defined_key-clsnet

module.position_ids saved_key-clsnet
module.final.weight saved_key-clsnet
module.final.bias saved_key-clsnet
module.position_embedding.weight saved_key-clsnet
module.multi_head_attention1.in_proj_weight saved_key-clsnet
module.multi_head_attention1.in_proj_bias saved_key-clsnet
module.multi_head_attention1.out_proj.weight saved_key-clsnet
module.multi_head_attention1.out_proj.bias saved_key-clsnet
module.feed_forward1.W_ff1.weight saved_key-clsnet
module.feed_forward1.W_ff1.bias saved_key-clsnet
module.feed_forward1.W_ff2.weight saved_key-clsnet
module.feed_forward1.W_ff2.bias saved_key-clsnet
module.layer_norm1.weight saved_key-clsnet
module.layer_norm1.bias saved_key-clsnet
module.multi_head_attention2.in_proj_weight saved_key-clsnet
module.multi_head_attention2.in_proj_bias saved_key-clsnet
module.multi_head_attention2.out_proj.weight saved_key-clsnet
module.multi_head_attention2.out_proj.bias saved_key-clsnet
module.layer_norm2.weight saved_key-clsnet
module.layer_norm2.bias saved_key-clsnet
Steps:   0%|          | 0/1000000 [00:00<?, ?it/s]True accepts_keep_fp32_wrapper
{'keep_fp32_wrapper': True} extra_args
Steps:   0%|          | 0/1000000 [00:15<?, ?it/s, loss=0.27, loss_mlm=1.05, lr=0.004, norm_mask=8.02, norm_target=8.62]Steps:   0%|          | 1/1000000 [00:15<4245:56:37, 15.29s/it, loss=0.27, loss_mlm=1.05, lr=0.004, norm_mask=8.02, norm_target=8.62]Steps:   0%|          | 1/1000000 [00:26<4245:56:37, 15.29s/it, loss=0.397, loss_mlm=1.16, lr=0.004, norm_mask=8.02, norm_target=8.62]Steps:   0%|          | 2/1000000 [00:26<3616:04:56, 13.02s/it, loss=0.397, loss_mlm=1.16, lr=0.004, norm_mask=8.02, norm_target=8.62]Steps:   0%|          | 2/1000000 [00:38<3616:04:56, 13.02s/it, loss=0.0883, loss_mlm=0.892, lr=0.004, norm_mask=8.02, norm_target=8.62]Steps:   0%|          | 3/1000000 [00:38<3397:40:50, 12.23s/it, loss=0.0883, loss_mlm=0.892, lr=0.004, norm_mask=8.02, norm_target=8.62]Steps:   0%|          | 3/1000000 [00:49<3397:40:50, 12.23s/it, loss=0.00677, loss_mlm=0.788, lr=0.004, norm_mask=8.02, norm_target=8.87]Steps:   0%|          | 4/1000000 [00:49<3297:55:46, 11.87s/it, loss=0.00677, loss_mlm=0.788, lr=0.004, norm_mask=8.02, norm_target=8.87]Steps:   0%|          | 4/1000000 [01:00<3297:55:46, 11.87s/it, loss=0.0232, loss_mlm=1.29, lr=0.004, norm_mask=8.02, norm_target=8.87]  Steps:   0%|          | 5/1000000 [01:00<3241:39:11, 11.67s/it, loss=0.0232, loss_mlm=1.29, lr=0.004, norm_mask=8.02, norm_target=8.87]Steps:   0%|          | 5/1000000 [01:11<3241:39:11, 11.67s/it, loss=0.0969, loss_mlm=0.842, lr=0.004, norm_mask=8.02, norm_target=8.87]Steps:   0%|          | 6/1000000 [01:11<3206:43:04, 11.54s/it, loss=0.0969, loss_mlm=0.842, lr=0.004, norm_mask=8.02, norm_target=8.87]Steps:   0%|          | 6/1000000 [01:23<3206:43:04, 11.54s/it, loss=0.168, loss_mlm=0.972, lr=0.004, norm_mask=8.02, norm_target=8.87] Steps:   0%|          | 7/1000000 [01:23<3185:01:50, 11.47s/it, loss=0.168, loss_mlm=0.972, lr=0.004, norm_mask=8.02, norm_target=8.87]Steps:   0%|          | 7/1000000 [01:34<3185:01:50, 11.47s/it, loss=0.0727, loss_mlm=1.04, lr=0.004, norm_mask=8.02, norm_target=9.33]Steps:   0%|          | 8/1000000 [01:34<3170:47:05, 11.41s/it, loss=0.0727, loss_mlm=1.04, lr=0.004, norm_mask=8.02, norm_target=9.33]Steps:   0%|          | 8/1000000 [01:45<3170:47:05, 11.41s/it, loss=0.219, loss_mlm=1.19, lr=0.004, norm_mask=8.02, norm_target=9.33] Steps:   0%|          | 9/1000000 [01:45<3161:05:24, 11.38s/it, loss=0.219, loss_mlm=1.19, lr=0.004, norm_mask=8.02, norm_target=9.33]Steps:   0%|          | 9/1000000 [01:57<3161:05:24, 11.38s/it, loss=0.119, loss_mlm=0.803, lr=0.004, norm_mask=8.02, norm_target=9.33]Steps:   0%|          | 10/1000000 [01:57<3154:48:29, 11.36s/it, loss=0.119, loss_mlm=0.803, lr=0.004, norm_mask=8.02, norm_target=9.33]Steps:   0%|          | 10/1000000 [02:08<3154:48:29, 11.36s/it, loss=0.0332, loss_mlm=1.18, lr=0.004, norm_mask=8.02, norm_target=9.33]Steps:   0%|          | 11/1000000 [02:08<3150:57:10, 11.34s/it, loss=0.0332, loss_mlm=1.18, lr=0.004, norm_mask=8.02, norm_target=9.33]Steps:   0%|          | 11/1000000 [02:19<3150:57:10, 11.34s/it, loss=0.171, loss_mlm=1.08, lr=0.004, norm_mask=8.02, norm_target=9.86] Steps:   0%|          | 12/1000000 [02:19<3148:12:50, 11.33s/it, loss=0.171, loss_mlm=1.08, lr=0.004, norm_mask=8.02, norm_target=9.86]Steps:   0%|          | 12/1000000 [02:31<3148:12:50, 11.33s/it, loss=0.0846, loss_mlm=0.962, lr=0.004, norm_mask=8.02, norm_target=9.86]Steps:   0%|          | 13/1000000 [02:31<3145:49:46, 11.33s/it, loss=0.0846, loss_mlm=0.962, lr=0.004, norm_mask=8.02, norm_target=9.86]Steps:   0%|          | 13/1000000 [02:42<3145:49:46, 11.33s/it, loss=0.161, loss_mlm=1.29, lr=0.004, norm_mask=8.02, norm_target=9.86]  Steps:   0%|          | 14/1000000 [02:42<3143:42:48, 11.32s/it, loss=0.161, loss_mlm=1.29, lr=0.004, norm_mask=8.02, norm_target=9.86]Steps:   0%|          | 14/1000000 [02:53<3143:42:48, 11.32s/it, loss=0.0353, loss_mlm=0.802, lr=0.004, norm_mask=8.02, norm_target=9.86]Steps:   0%|          | 15/1000000 [02:53<3141:30:27, 11.31s/it, loss=0.0353, loss_mlm=0.802, lr=0.004, norm_mask=8.02, norm_target=9.86]Steps:   0%|          | 15/1000000 [03:04<3141:30:27, 11.31s/it, loss=0.251, loss_mlm=1.24, lr=0.004, norm_mask=8.02, norm_target=10.4]  Steps:   0%|          | 16/1000000 [03:04<3141:19:57, 11.31s/it, loss=0.251, loss_mlm=1.24, lr=0.004, norm_mask=8.02, norm_target=10.4]Steps:   0%|          | 16/1000000 [03:16<3141:19:57, 11.31s/it, loss=0.0128, loss_mlm=0.858, lr=0.004, norm_mask=8.02, norm_target=10.4]Steps:   0%|          | 17/1000000 [03:16<3141:50:51, 11.31s/it, loss=0.0128, loss_mlm=0.858, lr=0.004, norm_mask=8.02, norm_target=10.4]Steps:   0%|          | 17/1000000 [03:27<3141:50:51, 11.31s/it, loss=0.32, loss_mlm=1.15, lr=0.004, norm_mask=8.02, norm_target=10.4]   Steps:   0%|          | 18/1000000 [03:27<3142:04:17, 11.31s/it, loss=0.32, loss_mlm=1.15, lr=0.004, norm_mask=8.02, norm_target=10.4]Steps:   0%|          | 18/1000000 [03:39<3142:04:17, 11.31s/it, loss=0.00955, loss_mlm=1.24, lr=0.004, norm_mask=8.02, norm_target=10.4]Steps:   0%|          | 19/1000000 [03:39<3180:32:39, 11.45s/it, loss=0.00955, loss_mlm=1.24, lr=0.004, norm_mask=8.02, norm_target=10.4]Steps:   0%|          | 19/1000000 [03:50<3180:32:39, 11.45s/it, loss=0.00281, loss_mlm=0.791, lr=0.004, norm_mask=8.02, norm_target=10.9]Steps:   0%|          | 20/1000000 [03:50<3168:27:59, 11.41s/it, loss=0.00281, loss_mlm=0.791, lr=0.004, norm_mask=8.02, norm_target=10.9]Steps:   0%|          | 20/1000000 [04:02<3168:27:59, 11.41s/it, loss=0.0937, loss_mlm=0.944, lr=0.004, norm_mask=8.02, norm_target=10.9] Steps:   0%|          | 21/1000000 [04:02<3159:42:38, 11.38s/it, loss=0.0937, loss_mlm=0.944, lr=0.004, norm_mask=8.02, norm_target=10.9]Steps:   0%|          | 21/1000000 [04:13<3159:42:38, 11.38s/it, loss=0.178, loss_mlm=0.902, lr=0.004, norm_mask=8.02, norm_target=10.9] Steps:   0%|          | 22/1000000 [04:13<3153:13:27, 11.35s/it, loss=0.178, loss_mlm=0.902, lr=0.004, norm_mask=8.02, norm_target=10.9]Steps:   0%|          | 22/1000000 [04:24<3153:13:27, 11.35s/it, loss=0.0837, loss_mlm=0.772, lr=0.004, norm_mask=8.02, norm_target=10.9]Steps:   0%|          | 23/1000000 [04:24<3149:12:52, 11.34s/it, loss=0.0837, loss_mlm=0.772, lr=0.004, norm_mask=8.02, norm_target=10.9]Steps:   0%|          | 23/1000000 [04:35<3149:12:52, 11.34s/it, loss=0.149, loss_mlm=0.858, lr=0.004, norm_mask=8.02, norm_target=11.4] Steps:   0%|          | 24/1000000 [04:35<3146:25:40, 11.33s/it, loss=0.149, loss_mlm=0.858, lr=0.004, norm_mask=8.02, norm_target=11.4]Steps:   0%|          | 24/1000000 [04:47<3146:25:40, 11.33s/it, loss=0.0835, loss_mlm=0.8, lr=0.004, norm_mask=8.02, norm_target=11.4] Steps:   0%|          | 25/1000000 [04:47<3144:04:08, 11.32s/it, loss=0.0835, loss_mlm=0.8, lr=0.004, norm_mask=8.02, norm_target=11.4]Steps:   0%|          | 25/1000000 [04:58<3144:04:08, 11.32s/it, loss=0.138, loss_mlm=1.13, lr=0.004, norm_mask=8.02, norm_target=11.4]Steps:   0%|          | 26/1000000 [04:58<3142:49:09, 11.31s/it, loss=0.138, loss_mlm=1.13, lr=0.004, norm_mask=8.02, norm_target=11.4]Steps:   0%|          | 26/1000000 [05:09<3142:49:09, 11.31s/it, loss=0.0407, loss_mlm=1.04, lr=0.004, norm_mask=8.02, norm_target=11.4]Steps:   0%|          | 27/1000000 [05:09<3141:40:27, 11.31s/it, loss=0.0407, loss_mlm=1.04, lr=0.004, norm_mask=8.02, norm_target=11.4]Steps:   0%|          | 27/1000000 [05:21<3141:40:27, 11.31s/it, loss=0.168, loss_mlm=0.627, lr=0.004, norm_mask=8.02, norm_target=11.8]Steps:   0%|          | 28/1000000 [05:21<3140:44:05, 11.31s/it, loss=0.168, loss_mlm=0.627, lr=0.004, norm_mask=8.02, norm_target=11.8]Steps:   0%|          | 28/1000000 [05:32<3140:44:05, 11.31s/it, loss=0.152, loss_mlm=0.755, lr=0.004, norm_mask=8.02, norm_target=11.8]Steps:   0%|          | 29/1000000 [05:32<3140:15:59, 11.31s/it, loss=0.152, loss_mlm=0.755, lr=0.004, norm_mask=8.02, norm_target=11.8]Steps:   0%|          | 29/1000000 [05:43<3140:15:59, 11.31s/it, loss=0.121, loss_mlm=1.12, lr=0.004, norm_mask=8.02, norm_target=11.8] Steps:   0%|          | 30/1000000 [05:43<3139:46:57, 11.30s/it, loss=0.121, loss_mlm=1.12, lr=0.004, norm_mask=8.02, norm_target=11.8]Steps:   0%|          | 30/1000000 [05:55<3139:46:57, 11.30s/it, loss=0.215, loss_mlm=1.09, lr=0.004, norm_mask=8.02, norm_target=11.8]Steps:   0%|          | 31/1000000 [05:55<3140:02:55, 11.30s/it, loss=0.215, loss_mlm=1.09, lr=0.004, norm_mask=8.02, norm_target=11.8]Steps:   0%|          | 31/1000000 [06:06<3140:02:55, 11.30s/it, loss=0.114, loss_mlm=0.648, lr=0.004, norm_mask=8.02, norm_target=12.2]Steps:   0%|          | 32/1000000 [06:06<3139:18:06, 11.30s/it, loss=0.114, loss_mlm=0.648, lr=0.004, norm_mask=8.02, norm_target=12.2]Steps:   0%|          | 32/1000000 [06:17<3139:18:06, 11.30s/it, loss=0.147, loss_mlm=1.25, lr=0.004, norm_mask=8.02, norm_target=12.2] Steps:   0%|          | 33/1000000 [06:17<3138:50:11, 11.30s/it, loss=0.147, loss_mlm=1.25, lr=0.004, norm_mask=8.02, norm_target=12.2]Steps:   0%|          | 33/1000000 [06:28<3138:50:11, 11.30s/it, loss=0.112, loss_mlm=0.931, lr=0.004, norm_mask=8.02, norm_target=12.2]Steps:   0%|          | 34/1000000 [06:28<3138:50:26, 11.30s/it, loss=0.112, loss_mlm=0.931, lr=0.004, norm_mask=8.02, norm_target=12.2]Steps:   0%|          | 34/1000000 [06:40<3138:50:26, 11.30s/it, loss=0.0214, loss_mlm=0.754, lr=0.004, norm_mask=8.02, norm_target=12.2]Steps:   0%|          | 35/1000000 [06:40<3138:49:55, 11.30s/it, loss=0.0214, loss_mlm=0.754, lr=0.004, norm_mask=8.02, norm_target=12.2]Steps:   0%|          | 35/1000000 [06:51<3138:49:55, 11.30s/it, loss=0.0845, loss_mlm=1.18, lr=0.004, norm_mask=8.02, norm_target=12.6] Steps:   0%|          | 36/1000000 [06:51<3138:33:19, 11.30s/it, loss=0.0845, loss_mlm=1.18, lr=0.004, norm_mask=8.02, norm_target=12.6]Steps:   0%|          | 36/1000000 [07:02<3138:33:19, 11.30s/it, loss=0.0134, loss_mlm=0.83, lr=0.004, norm_mask=8.02, norm_target=12.6]Steps:   0%|          | 37/1000000 [07:02<3139:07:47, 11.30s/it, loss=0.0134, loss_mlm=0.83, lr=0.004, norm_mask=8.02, norm_target=12.6]